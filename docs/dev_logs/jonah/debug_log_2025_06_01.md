---
log_owner: jonah
week: 2025-05-26 to 2025-06-01
repo_version: 0cfbb76917556dac7824355ebd285de0c76d2989
created_at: 2025-06-01T10:47:23-0400
tags: [debug, event_bus, ipc, zmq, protocol-pure, cross-process, blocker]
---

# Debug Log â€“ Week of 2025-05-26 to 2025-06-01

## 2025-06-01

### [10:47] Cross-Process Event Bus Debugging (IPC & ZMQ)

**Engineer:** jonah  
**Tags:** #debug #event_bus #ipc #zmq #protocol-pure #cross-process #blocker

**Context:**
- Milestone 1 requires robust, protocol-pure, cross-process event bus delivery for both IPC and ZMQ backends.
- In-process ZMQ event bus tests pass, but both cross-process tests fail (no event delivered to subscriber process).
- All debug output is routed through protocol-pure log events (no prints).

**Problem Statement:**
- Cross-process event delivery is broken for both IPC and ZMQ event buses.
- Publisher process cannot deliver events to the subscriber process; only STRUCTURED_LOG events are received, not the test event.
- IPC: "No buffer space available" errors; ZMQ: no event received by subscriber.

**Hypotheses:**
1. Subscriber process is not fully ready before publisher sends event (handshake/ready logic insufficient).
2. Event bus or thread pool is being shut down before event is delivered.
3. ZMQ slow joiner problem or socket context not shared correctly across processes.
4. STRUCTURED_LOG events are being delivered, but domain events are not (possible filtering or delivery bug).

**Investigation Steps:**
- Added detailed protocol-pure debug logging to both publisher and subscriber processes (using emit_log_event, no prints).
- Increased ready_event wait timeout to 2s in publisher.
- Ensured subscriber process logs when ready and after subscribing.
- Observed that only STRUCTURED_LOG events are received in the queue; test event is not delivered.
- IPC: observed repeated "No buffer space available" errors on publish.
- ZMQ: no errors, but no event received by subscriber.

**Findings:**
- In-process ZMQ event bus works; cross-process does not.
- Subscriber process is alive and signals ready, but does not receive domain events.
- STRUCTURED_LOG events are delivered, indicating some event bus traffic is working.
- IPC socket buffer exhaustion may indicate resource leak or improper socket cleanup.
- ZMQ likely still affected by slow joiner or process isolation.

**Next Steps:**
- Filter out STRUCTURED_LOG events in test assertions; only assert on domain events.
- Increase subscriber process lifetime (wait longer for event delivery).
- Explicitly flush and close event bus in subscriber after event received.
- For ZMQ: add longer delay after subscriber ready before publisher sends event.
- For IPC: investigate socket file permissions, cleanup, and consider alternate IPC library if needed.
- Continue protocol-pure, debug-log-driven investigation until cross-process delivery is robust.

---

# Weekly Summary (to be completed at end of week)
- Engineers: jonah
- Major issues: Cross-process event bus delivery (IPC/ZMQ)
- Key solutions: [pending]
- Blockers: Cross-process event delivery
- Next steps: [pending] 