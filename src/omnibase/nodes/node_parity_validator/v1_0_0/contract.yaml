# Canonical ONEX contract for the node_parity_validator node.
# This contract defines the state, protocol, and error codes for node_parity_validator.
# Update input/output fields and error codes as the node evolves.
---

contract_version: 1.0.0
node_name: node_parity_validator
node_version: 1.0.0
contract_name: node_parity_validator_contract
contract_description: State contract for node_parity_validator (now includes full diagnostics and parity reporting)
input_state:
  type: object
  properties:
    version:
      $ref: '#/definitions/SemVerModel'
      description: Schema version for input state
    nodes_directory:
      type: string
      description: Path to the directory containing ONEX nodes to validate
    validation_types:
      type: array
      items:
        type: string
      description: List of validation types to run (e.g., cli_node_parity, schema_conformance, error_code_usage, contract_compliance, introspection_validity)
    node_filter:
      type: array
      items:
        type: string
      description: Optional list of node names to filter validation
    verbose:
      type: boolean
      description: Enable verbose output
    # Traceability fields (ONEX standard)
    event_id:
      type: string
      description: Unique event identifier (UUID)
    correlation_id:
      type: string
      description: Correlation ID for tracing requests/events
    node_name:
      type: string
      description: Name of the node processing the event
    node_version:
      $ref: '#/definitions/SemVerModel'
      description: Version of the node
    timestamp:
      type: string
      format: date-time
      description: ISO8601 timestamp of the event
  required:
    - version
    - nodes_directory
output_state:
  type: object
  properties:
    version:
      $ref: '#/definitions/SemVerModel'
      description: Schema version for output state (matches input)
    status:
      type: string
      enum:
        - success
        - warning
        - error
        - skipped
        - fixed
        - partial
        - info
        - unknown
      description: Execution status
    message:
      type: string
      description: Human-readable result message
    output_field:
      $ref: '#/definitions/ModelParityValidatorOutputField'
    discovered_nodes:
      type: array
      items:
        $ref: '#/definitions/DiscoveredNode'
      description: List of all discovered ONEX nodes (full diagnostics)
    validation_results:
      type: array
      items:
        $ref: '#/definitions/NodeValidationResult'
      description: Detailed validation results for each node and validation type
    summary:
      type: object
      properties:
        passed:
          type: integer
        failed:
          type: integer
      description: Summary statistics (total_nodes, total_validations, passed, failed, skipped, errors)
    nodes_directory:
      type: string
      description: Directory that was scanned
    validation_types_run:
      type: array
      items:
        type: string
      description: List of validation types that were executed
    total_execution_time_ms:
      type: number
      description: Total time taken for all validations in milliseconds
    event_id:
      type: string
      description: Unique event identifier (UUID)
    correlation_id:
      type: string
      description: Correlation ID for tracing requests/events
    node_name:
      type: string
      description: Name of the node processing the event
    node_version:
      $ref: '#/definitions/SemVerModel'
      description: Version of the node
    timestamp:
      type: string
      format: date-time
      description: ISO8601 timestamp of the event
  required:
    - version
    - status
    - message
    - discovered_nodes
    - validation_results
    - summary
    - nodes_directory
    - validation_types_run
    - output_field
# To extend output fields, see the ModelParityValidatorOutputField definition below.

error_codes:
  - UNKNOWN_ERROR
  - INVALID_PARAMETER
  - MISSING_REQUIRED_PARAMETER
  - SCHEMA_VALIDATION_FAILED
  - UNSUPPORTED_OPERATION
  - NODE_DISCOVERY_FAILED
  - VALIDATION_TYPE_NOT_FOUND
  - VALIDATION_EXECUTION_ERROR
  - SNAPSHOT_MISMATCH

definitions:
  DiscoveredNode:
    type: object
    properties:
      name:
        type: string
        description: Node name
      version:
        type: string
        description: Node version
      module_path:
        type: string
        description: Python module path
      introspection_available:
        type: boolean
        description: Whether introspection is available
      cli_entrypoint:
        type: string
        description: CLI entrypoint command
      error_count:
        type: integer
        description: Number of errors during discovery
    required:
      - name
      - version
      - module_path
      - introspection_available
      - error_count
  NodeValidationResult:
    type: object
    properties:
      node_name:
        type: string
        description: Name of the validated node
      node_version:
        type: string
        description: Version of the validated node
      validation_type:
        type: string
        description: Type of validation performed
      result:
        type: string
        description: Validation result (e.g., pass/fail)
      message:
        type: string
        description: Human-readable result message
      details:
        type: object
        additionalProperties:
          type: string
        description: Additional details about the validation
      execution_time_ms:
        type: number
        description: Time taken for this validation in milliseconds
    required:
      - node_name
      - node_version
      - validation_type
      - result
      - message
  ModelParityValidatorOutputField:
    type: object
    properties:
      results:
        type: object
        additionalProperties:
          type: object
          additionalProperties:
            type: string
        description: Validation results per node and validation type
      summary:
        type: object
        properties:
          passed:
            type: integer
          failed:
            type: integer
        description: Summary of validation results
    required:
      - results
      - summary
  SemVerModel:
    type: object
    properties:
      major:
        type: integer
      minor:
        type: integer
      patch:
        type: integer
      prerelease:
        type: string
        nullable: true
      build:
        type: string
        nullable: true
    required:
      - major
      - minor
      - patch
    description: Semantic version model for ONEX nodes

examples:
  valid_input:
    version: 1.0.0
    nodes_directory: "src/omnibase/nodes"
    validation_types: ["cli_node_parity", "schema_conformance"]
    node_filter: ["node_logger", "node_template"]
    verbose: true
    event_id: "123e4567-e89b-12d3-a456-426614174000"
    correlation_id: "corr-abc-123"
    node_name: "node_parity_validator"
    node_version: "1.0.0"
    timestamp: "2025-06-06T12:00:00Z"
  valid_output:
    version: 1.0.0
    status: success
    message: All validations passed
    output_field:
      results:
        node_logger:
          cli_node_parity: pass
          schema_conformance: pass
        node_template:
          cli_node_parity: pass
          schema_conformance: fail
      summary:
        passed: 1
        failed: 1
    discovered_nodes:
      - name: node_logger
        version: 1.0.0
        module_path: src/omnibase/nodes/node_logger/v1_0_0/node.py
        introspection_available: true
        cli_entrypoint: "onex run node_logger"
        error_count: 0
      - name: node_template
        version: 1.0.0
        module_path: src/omnibase/nodes/node_template/v1_0_0/node.py
        introspection_available: true
        cli_entrypoint: "onex run node_template"
        error_count: 1
    validation_results:
      - node_name: node_logger
        node_version: 1.0.0
        validation_type: cli_node_parity
        result: pass
        message: CLI matches contract
        details: {}
        execution_time_ms: 12.5
      - node_name: node_template
        node_version: 1.0.0
        validation_type: schema_conformance
        result: fail
        message: Schema mismatch
        details:
          error: "Field 'foo' missing"
        execution_time_ms: 18.2
    summary:
      passed: 1
      failed: 1
    nodes_directory: "src/omnibase/nodes"
    validation_types_run: ["cli_node_parity", "schema_conformance"]
    total_execution_time_ms: 45.7
    event_id: "123e4567-e89b-12d3-a456-426614174000"
    correlation_id: "corr-abc-123"
    node_name: "node_parity_validator"
    node_version: "1.0.0"
    timestamp: "2025-06-06T12:00:00Z"

hash: ''
last_modified_at: '2025-06-06T00:00:00Z'
